<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-lg border-0 rounded-lg">
        <div class="card-header bg-primary text-white text-center py-4">
          <h3 class="mb-0"><i class="fas fa-sign-in-alt me-2"></i>Login</h3>
        </div>
        <div class="card-body p-4">
          <div class="text-center mb-4">
            <div class="avatar-circle-large bg-primary text-white mx-auto">
              <i class="fas fa-user"></i>
            </div>
          </div>

          <form id="loginForm">
            <div class="mb-3">
              <label for="email" class="form-label">Email Address</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                <input type="email" class="form-control" id="email" name="email" placeholder="example@example.com" required>
              </div>
            </div>

            <div class="mb-4">
              <label for="password" class="form-label">Password</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fas fa-lock"></i></span>
                <input type="password" class="form-control" id="password" name="password" placeholder="Abcd1234" required>
              </div>
            </div>

            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-sign-in-alt me-2"></i> Login
              </button>
            </div>
          </form>

          <!-- Feedback message -->
          <div id="messageBox" class="text-center mt-3"></div>
        </div>

        <div class="card-footer bg-light py-3">
          <div class="text-center">
            <p class="mb-0">Don't have an account?</p>
            <div class="mt-2">
              <a href="/auth/register" class="btn btn-outline-primary me-2">
                <i class="fas fa-user-plus me-1"></i> Register as User
              </a>
              <a href="/auth/register-mechanic" class="btn btn-outline-success">
                <i class="fas fa-tools me-1"></i> Register as Mechanic
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .avatar-circle-large {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin-bottom: 1.5rem;
  }
</style>

<script>
  // Clear inputs when page loads
  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
  });

  const loginForm = document.getElementById('loginForm');
  const messageBox = document.getElementById('messageBox');

  loginForm.addEventListener('submit', async function(event) {
    event.preventDefault();

    // Get input values
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();

    // Simple validation
    if (!email || !password) {
      showMessage('Please fill all fields!', 'danger');
      return;
    }

    try {
      const response = await fetch('http://localhost:3001/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, password })
      });

      const result = await response.json();

      if (response.ok) {
        showMessage('Login successful! Redirecting...', 'success');
        localStorage.setItem('token', result.token);
// send on the basis of role 

        setTimeout(() => {
          const userRole = result.user.role; // Get the user's role from the response
          if (userRole === 'mechanic') {
            window.location.href = '/mechanic/dashboard'; // Redirect to mechanic dashboard
          } else if (userRole === 'admin') {
            window.location.href = '/admin/dashboard'; // Redirect to admin dashboard
          } else {
            window.location.href = '/user/dashboard'; // Redirect to user dashboard
          }
        }, 1500);
      } else {
        showMessage(result.message || 'Invalid credentials', 'danger');
      }
    } catch (error) {
      console.error('Login error:', error);
      showMessage('Something went wrong. Please try again.', 'danger');
    }
  });

  function showMessage(message, type) {
    messageBox.innerHTML = `
      <div class="alert alert-${type} mt-3" role="alert">
        ${message}
      </div>
    `;
    setTimeout(() => (messageBox.innerHTML = ''), 3000);
  }
</script>